"use strict";(self.webpackChunk_teamhanko_docs=self.webpackChunk_teamhanko_docs||[]).push([[482],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>h});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=o.createContext({}),u=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=u(e.components);return o.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=u(n),h=a,k=p["".concat(c,".").concat(h)]||p[h]||d[h]||r;return n?o.createElement(k,i(i({ref:t},s),{},{components:n})):o.createElement(k,i({ref:t},s))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<r;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},4646:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var o=n(7462),a=(n(7294),n(3905));const r={title:"Login with Google",sidebar_label:"Google",keywords:["social login","google"],sidebar_custom_props:{docCardIconName:"google"}},i="Login With Google",l={unversionedId:"guides/social/google",id:"guides/social/google",title:"Login with Google",description:"To enable Google login for your project, you need to",source:"@site/docs/guides/social/google.mdx",sourceDirName:"guides/social",slug:"/guides/social/google",permalink:"/guides/social/google",draft:!1,tags:[],version:"current",frontMatter:{title:"Login with Google",sidebar_label:"Google",keywords:["social login","google"],sidebar_custom_props:{docCardIconName:"google"}},sidebar:"docs",previous:{title:"Social Login",permalink:"/guides/social/"},next:{title:"GitHub",permalink:"/guides/social/github"}},c={},u=[{value:"Access your Google Cloud Platform account",id:"access-your-google-cloud-platform-account",level:2},{value:"Create a Google Cloud Platform project",id:"create-a-google-cloud-platform-project",level:2},{value:"Set up OAuth consent screen",id:"set-up-oauth-consent-screen",level:2},{value:"Edit app registration",id:"edit-app-registration",level:2},{value:"Get your callback URL",id:"get-your-callback-url",level:2},{value:"Create your Google credentials",id:"create-your-google-credentials",level:2},{value:"Configure Google credentials with your Hanko backend",id:"configure-google-credentials-with-your-hanko-backend",level:2},{value:"Enable login in your frontend app",id:"enable-login-in-your-frontend-app",level:2},{value:"With Hanko Elements",id:"with-hanko-elements",level:3},{value:"With Hanko Frontend SDK",id:"with-hanko-frontend-sdk",level:3}],s={toc:u};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"login-with-google"},"Login With Google"),(0,a.kt)("p",null,"To enable Google login for your project, you need to"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Create and configure a Google Project on the Google Cloud Platform Console."),(0,a.kt)("li",{parentName:"ul"},"Create and add your Google OAuth credentials to your Hanko backend configuration."),(0,a.kt)("li",{parentName:"ul"},"Add the Hanko ",(0,a.kt)("inlineCode",{parentName:"li"},"auth")," web component or add the required code to your JS Client App using the ",(0,a.kt)("inlineCode",{parentName:"li"},"hanko-frontend-sdk"),".")),(0,a.kt)("h2",{id:"access-your-google-cloud-platform-account"},"Access your Google Cloud Platform account"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Go to ",(0,a.kt)("a",{parentName:"li",href:"https://console.cloud.google.com"},"console.cloud.google.com"),"."),(0,a.kt)("li",{parentName:"ul"},"Click on 'Sign in' at the top right to log in. If you do not have an account yet, create one.")),(0,a.kt)("h2",{id:"create-a-google-cloud-platform-project"},"Create a Google Cloud Platform project"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Click on 'Select a Project' at the top left."),(0,a.kt)("li",{parentName:"ul"},"Click 'New Project' at the top right."),(0,a.kt)("li",{parentName:"ul"},"Provide a 'Project name'."),(0,a.kt)("li",{parentName:"ul"},"If you want the project to be part of an organization, assign it using the 'Location' input."),(0,a.kt)("li",{parentName:"ul"},"Click Create. On success, you should now view the dashboard for your new project.")),(0,a.kt)("h2",{id:"set-up-oauth-consent-screen"},"Set up OAuth consent screen"),(0,a.kt)("p",null,"On your project's dashboard:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"In the search bar at the top labeled 'Search for resources, docs, products, and more' type 'oauth'."),(0,a.kt)("li",{parentName:"ul"},"Click on 'OAuth consent screen' from the list of results."),(0,a.kt)("li",{parentName:"ul"},"On the OAuth consent screen page select:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"'External' if you want the project to be available to anyone with a Google Account."),(0,a.kt)("li",{parentName:"ul"},"'Internal' if the project is associated with an organization, and you want to restrict access to members of the\norganization."))),(0,a.kt)("li",{parentName:"ul"},"Click Create.")),(0,a.kt)("h2",{id:"edit-app-registration"},"Edit app registration"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Provide 'App information', 'App logo', and 'App domain' data. You do not need to add an 'Authorised domain' at this\npoint. An entry will be added automatically once you set up your credentials. Click 'Save and continue'."),(0,a.kt)("li",{parentName:"ul"},"On the 'Scopes' view, click 'Add or remove scopes' and select the 'userinfo.email' scope. Click 'Update', then\n'Save and continue'."),(0,a.kt)("li",{parentName:"ul"},"On the 'Test users' view, click 'Add users' to set up test users as long as your project is unpublished. Click\n'Save and continue'."),(0,a.kt)("li",{parentName:"ul"},"Review your data in the 'Summary' view, then click 'Back to dashboard'.")),(0,a.kt)("h2",{id:"get-your-callback-url"},"Get your callback URL"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Before creating your OAuth app, you need to be aware of the provider callback URL. This is where the third party\nprovider redirects after a successful login. The callback URL consists of the base URL of your running\nHanko backend instance and the ",(0,a.kt)("inlineCode",{parentName:"li"},"/thirdparty/callback")," endpoint:")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"https://<your_hanko_backend_instance>/thirdparty/callback")),(0,a.kt)("h2",{id:"create-your-google-credentials"},"Create your Google credentials"),(0,a.kt)("p",null,"On your project's dashboard:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"In the search bar at the top labeled 'Search for resources, docs, products, and more' type 'oauth'."),(0,a.kt)("li",{parentName:"ul"},"Click 'Credentials' in the search results."),(0,a.kt)("li",{parentName:"ul"},"Click 'Create Credentials' at the top, select 'OAuth client ID'"),(0,a.kt)("li",{parentName:"ul"},"On the Create OAuth client ID page, select your application type. Select 'Web application'."),(0,a.kt)("li",{parentName:"ul"},"Enter your app name."),(0,a.kt)("li",{parentName:"ul"},"Under 'Authorized redirect URIs' click 'Add URI' and add your callback URL in the input."),(0,a.kt)("li",{parentName:"ul"},"Click 'Create'.")),(0,a.kt)("h2",{id:"configure-google-credentials-with-your-hanko-backend"},"Configure Google credentials with your Hanko backend"),(0,a.kt)("p",null,"Open up your backend ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/teamhanko/hanko/blob/main/backend/config/config.yaml"},"configuration file")," add\nthe following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"third_party:\n  # URL the backend redirects to if an error occurs during third party sign-in. Errors are provided\n  # as 'error' and 'error_description' query params in the redirect location URL.\n  #\n  # When using the Hanko web components it should be the URL of the page that embeds the web component\n  # such that errors can be processed properly by the web component.\n  #\n  # You do not have to add this URL to the 'allowed_redirect_urls', it is automatically included when\n  # validating redirect URLs.\n  #\n  # NOTE: MUST NOT have trailing slash\n  error_redirect_url: <your_error_redirect_url>\n  # List of URLS the backend is allowed to redirect to after third party sign-in was successful.\n  #\n  # When using the Hanko web components it should be the URL of the page that embeds the\n  # web component.\n  #\n  # Supports wildcard matching through globbing. e.g. https://*.example.com will allow\n  # https://foo.example.com and https://bar.example.com to be accepted. Globbing is also\n  # supported for paths, e.g. https://foo.example.com/* will match https://foo.example.com/page1\n  # and https://foo.example.com/page2.\n  #\n  # More on globbing: https://pkg.go.dev/github.com/gobwas/glob#Compile\n  #\n  # NOTE: URLs in the list MUST NOT have trailing slash\n  allowed_redirect_urls:\n      - <your_redirect_url>\n  redirect_url: https://<your_hanko_backend_instance>/thirdparty/callback\n  providers:\n    google:\n      enabled: true\n      client_id: <your_google_client_id>\n      secret: <your_google_client_secret>\n")),(0,a.kt)("h2",{id:"enable-login-in-your-frontend-app"},"Enable login in your frontend app"),(0,a.kt)("h3",{id:"with-hanko-elements"},"With Hanko Elements"),(0,a.kt)("p",null,"Depending on what framework your frontend uses, integrate the ",(0,a.kt)("inlineCode",{parentName:"p"},"auth")," web component from the ",(0,a.kt)("inlineCode",{parentName:"p"},"hanko-elements")," package\naccording to one of our ",(0,a.kt)("a",{parentName:"p",href:"/guides/frontend"},"frontend guides"),". If everything was successful, the component should now\nrender a button to login with GitHub on the login view."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Make sure to configure the page the web component is embedded on as both your ",(0,a.kt)("inlineCode",{parentName:"p"},"error_redirect_url")," as well\nas an ",(0,a.kt)("inlineCode",{parentName:"p"},"allowed_redirect_url")," in your ",(0,a.kt)("inlineCode",{parentName:"p"},"third_party")," settings.")),(0,a.kt)("p",null,"On successful authentication with the third party provider, the backend issues a JWT (as a cookie or - if enabled\nvia backend ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/teamhanko/hanko/blob/main/backend/docs/Config.md"},"configuration")," option\n",(0,a.kt)("inlineCode",{parentName:"p"},"session.enable_auth_token_header")," - via ",(0,a.kt)("inlineCode",{parentName:"p"},"X-Auth-Token")," header). The web component recognizes this and continues the\nusual component flow on success or displays errors that occurred during third party\nprovider authentication accordingly."),(0,a.kt)("h3",{id:"with-hanko-frontend-sdk"},"With Hanko Frontend SDK"),(0,a.kt)("p",null,"When building your own UI, you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"@teamhanko/hanko-frontend-sdk")," to initialize third party sign in.\nCall ",(0,a.kt)("inlineCode",{parentName:"p"},"hanko.thirdParty.auth")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"google")," as your provider and the target URL in your app you want to redirect to\nafter successful third party authentication (must be\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/teamhanko/hanko/blob/main/backend/docs/Config.md"},"configured")," as an allowed redirect url via\n",(0,a.kt)("inlineCode",{parentName:"p"},"third_party.allowed_redirect_urls"),"). Doing so redirects you to the third party provider, where you then will be prompted\nto authenticate and provide consent for the API to access your data."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},'import { Hanko } from "@teamhanko/hanko-frontend-sdk"\n\nconst hanko = new Hanko("<your_hanko_backend_instance>")\n\nasync function signInWithGoogle() {\n    try {\n       await hanko.thirdParty.auth("google", "<your_redirect_url>");\n    } catch (error) {\n      // handle error\n    }\n}\n')),(0,a.kt)("p",null,"On successful authentication with the third party provider, the API redirects you to the given redirect URL. The\nURL query includes a one time token that must be exchanged for a JWT. Use the ",(0,a.kt)("inlineCode",{parentName:"p"},"hanko.token.validate"),"\nmethod to validate the token:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},'import { Hanko } from "@teamhanko/hanko-frontend-sdk"\n\nconst hanko = new Hanko("<your_hanko_backend_instance>")\n\nasync function onLoad() {\n    try {\n       await hanko.token.validate();\n    } catch (error) {\n      // handle error\n    }\n\n    // you should now have a JWT cookie set\n}\n')),(0,a.kt)("p",null,"On success, the API issues a JWT which is then set by the SDK as a cookie (",(0,a.kt)("inlineCode",{parentName:"p"},"hanko"),"). All other SDK methods can now\nuse the cookie to make authenticated requests to the API (if your frontend runs on a different domain, make sure to\ninclude your frontend domain in the ",(0,a.kt)("inlineCode",{parentName:"p"},"server.public.cors.allowed_origins")," in your\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/teamhanko/hanko/blob/main/backend/docs/Config.md"},"configuration"),")."))}d.isMDXComponent=!0}}]);